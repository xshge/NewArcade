<!-- save as game.html -->
<html dir="auto">

<head>
  <link rel="icon" type="image/png" href="favicon.png">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>game</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Quicksand:wght@400;600&display=swap');

    body {
      margin: 0;
      padding: 2rem;
      background-color: #fef8e4;
      font-family: 'Quicksand', sans-serif;
      color: #333;
      text-align: center;
    }

    #gameArea {
      font-size: 18px;
      line-height: 1.8;
      margin: 0 auto;
      max-width: 800px;
      background: #fffdf5;
      padding: 2rem;
      border: 4px solid #ffcd4f;
      border-radius: 10px;
      box-shadow: 0 6px #f2b705;
      font-family: 'Quicksand', sans-serif;
    }

    a {
      display: inline-block;
      margin: 1rem 0.5rem;
      font-size: 14px;
      font-family: 'Press Start 2P', cursive;
      color: #fff;
      background-color: #ff69b4;
      padding: 0.8rem 1.2rem;
      border-radius: 6px;
      text-decoration: none;
      transition: background-color 0.2s ease;
      box-shadow: 0 4px #d9408f;
    }

    a:hover {
      background-color: #ff85c1;
    }
  </style>

  <!-- [Your script stays the same] -->
  <script>
    // [All your existing JavaScript is unchanged here...]
    var embedDat = "PASTE YOUR EMBED DATA HERE (trimmed for clarity)";
    var gameState = null;
    var aurl = document.createElement('a');
    function qualifyURL(url) {
      aurl.href = url;
      return aurl.href;
    }

    function getParameterByName(name) {
      name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
      var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
        results = regex.exec(location.search);
      return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
    }

    function strip_http(url) {
      url = url.replace(/^https?:\/\//, '');
      return url;
    }

    function startSection() {
      if (gameState == null) {
        return "";
      }
      var param = getParameterByName("section");
      var result = "__STARTSECTION__" in gameState ? gameState["__STARTSECTION__"] : "START";
      if (param.length > 0) {
        result = param;
      }
      return result;
    }

    function init() {
      if (embedDat.length > 0 && embedDat[0] !== '_') {
        var dat = decodeURI(embedDat);
        gameState = JSON.parse(dat);
        var startKey = startSection();
        goTo(startKey);
        return;
      }

      var id = getParameterByName("p").replace(/[\\\/]/, "");
      if (id === null || id.length === 0) {
        console.log("No ID specified in URL.")
        return;
      }

      var githubURL = 'https://api.github.com/gists/' + id;
      var githubHTTPClient = new XMLHttpRequest();
      githubHTTPClient.open('GET', githubURL);
      githubHTTPClient.onreadystatechange = function () {
        if (githubHTTPClient.readyState != 4) return;
        var result = JSON.parse(githubHTTPClient.responseText);
        if (githubHTTPClient.status === 403) {
          console.log(result.message);
        } else if (githubHTTPClient.status !== 200 && githubHTTPClient.status !== 201) {
          console.log("HTTP Error " + githubHTTPClient.status + ' - ' + githubHTTPClient.statusText);
        }
        var code = result["files"]["game.txt"]["content"];
        gameState = JSON.parse(code);
        goTo(startSection());
      }
      githubHTTPClient.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
      githubHTTPClient.send();

      goTo(startSection());
    }

    function escapeHtmlEntities(str) {
      return str
        .replace(/&/g, '&amp;')
        .replace(/>/g, '&gt;')
        .replace(/</g, '&lt;')
        .replace(/"/g, '&quot;');
    }

    function goTo(targetState) {
      if (gameState == null) return;
      var curstate = gameState[targetState];
      var gameArea = document.getElementById("gameArea");
      var str = "";
      for (var i = 0; i < curstate.length; i++) {
        var l = curstate[i];
        if (l.length == 1) {
          str += escapeHtmlEntities(l[0]) + "<br>";
        } else if (l.length == 2) {
          str += '<a href="#" onclick="goTo(\'' + escapeHtmlEntities(l[1]) + '\');return false;">' + escapeHtmlEntities(l[0]) + '</a><br>';
        }
      }
      gameArea.innerHTML = str;
    }
  </script>
</head>

<body onload="init();">
  <div id="gameArea" dir="auto"></div>
</body>

</html>
